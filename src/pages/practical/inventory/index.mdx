---
title: Inventory Micro App
---

<PageDescription>

An example three tier application architecture you can build and have deployed in IBM Kubernetes service or IBM Red Hat OpenShift in less than an hour using the IBM Garage for Cloud Developer Tools and Starter Kit Templates.

</PageDescription>

## Business Need

In this guide imagine you have completed a [Enterprise Design Thinking Workshop](https://www.ibm.com/garage/method/practices/think/enterprise-design-thinking/) and the out come is a single **Hill** defining the desired business outcomes. Use the steps below to help deliver this **Hill** quickly and to [Garage Method Best Practices](https://www.ibm.com/garage/method).

## [Hills](https://www.ibm.com/garage/method/practices/think/practice_hills/)

- **Who** Provide an internal web application system that can be used by distribution employees securely from each of the regional warehouses. The warehouses are linked using the public internet.

- **What** Enable a secure web application that will allow the warehouse employees to gain easy access to list of product [SKU](https://en.wikipedia.org/wiki/Stock_keeping_unit) inventory levels and inventory locations.

- **Wow** Make the system appealing and easy to use. Deliver it to the IBM Cloud platform in a short focused [Minimal Viable Product](https://www.ibm.com/garage/method/practices/think/practice_minimum_viable_product/). Use the latest managed container runtimes and DevOps best practices to enable post MVP feature improvements. Simulate a release to a  _Test_ environment.

## [Architecture]()

The Micro App should be built using a three tier microservices architecture. Each tier will follow a clean separation of concerns. Each app component will be modelled using _Microservices_ and use a number of [polyglot](https://searchsoftwarequality.techtarget.com/definition/polyglot-programming) programming languages and frameworks. Data will be stored in IBM Cloudant and the Micro App will be secured using IBM App ID.

![Architecture](images/architecture.png)

## [Design]()

The Micro App should adhere to the following User Interface Design and API and Model Design.

![UI Design](/images/inventory-ui-design.png)

## Technical Requirements
- The Mico App should adhere to the following technical requirements:

    - Polyglot Microservices
    - Stateless
    - REST APIs
    - DevOps with Continous Integration and Delivery
    - Monitoring and Logging
    - Code Analysis
    - App Security
    - Deployed to Red Hat OpenShift or IBM Kubernetes Managed Service
    - Follow [Carbon Design System](https://www.carbondesignsystem.com/) User Experience

## Guide

### Inventory User Interface

#### Setup

Get the initial project created and register the pipeline for automated builds.

1. Create a new repository from the React Starter Kit template - https://github.com/ibm-garage-cloud/template-node-react/generate

2. Clone the new repository to your machine

3. Update the project name in the `package.json` to match the repository

4. Log into the cluster from the command-line then register the pipeline in Jenkins using `igc pipeline`

#### Initial components

Clean up the UI Design patterns view to include only one entry for Stock Items.
Based on the requirements of this first use case we can base the work off of 
the TableList pattern. 

1. Make a copy of the `TableList` pattern component in the components folder. Rename the
file and the class inside to `StockItemList`

2. Update UIShell.jsx
  - Update the initial pattern name to `Stock Items`
  - Update the SideNameMenu title to Inventory Management
  - Remove all the patterns from the SideNavMenu and add a line to render the Stock Items menu - `this.renderSideNavItem("Stock Items")`
  
components/UIShell.jsx
```javascript
class UIShell extends Component {
  constructor(props) {
    super(props);
    this.state = {
      patternName: "Stock Items"
    };
  }

  ...

  render() {
    return (
      <div>
        <Header aria-label="IBM Platform Name">
          <SkipToContent />
          <HeaderName href="#" prefix="IBM">
            Garage for Cloud Catalyst
          </HeaderName>
        </Header>
        <SideNav aria-label="Side navigation">
          <SideNavItems>
            <SideNavMenu
              defaultExpanded
              icon={<Fade20 />}
              title="Inventory Management"
            >
              {this.renderSideNavItem("Stock Items")}
            </SideNavMenu>
          </SideNavItems>
        </SideNav>
        <Content id="main-content"><UIShellBody patternName={this.state.patternName} /></Content>
      </div>
    );
  }
}
```

3. Update UIShellBody.jsx

  - Remove all of the pattern values from the `components` map and add only show StockItem List
  - Use `Stock Items` as the default pattern name when none is given

components/UIShellBody.jsx
```javascript
class UIShellBody extends Component {
  components = {
    "Stock Items": StockItemList,
  };
  render() {
    const PatternName = this.components[
      this.props.patternName || "Stock Items"
    ];
    return (
      <div className="pattern-container">
        <PatternName showDescription={true} />
      </div>
    );
  }
}
```

#### Update StockItemList according to the requirements

1. Update the data structure for our sample data to match the UI

components/StockItemList.jsx
```javascript
class StockItemList extends Component {
  ...

  componentDidMount() {
    const data = [
      {
        "name": "Item 1",
        "description": "The first item",
        "stock": 10,
        "unitPrice": 100.0,
        "picture": "test",
        "manufacturer": "unknown",
      },
      {
        "name": "Item 2",
        "description": "The second item",
        "stock": 15,
        "unitPrice": 120.5,
        "picture": "test1",
        "manufacturer": "Apple",
      },
      {
        "name": "Item 3",
        "description": "The third item",
        "stock": 20,
        "unitPrice": 75.5,
        "picture": "test1",
        "manufacturer": "Sony",
      }
    ];

    this.setState({
      data
    });
  }

  ...
}
```

2. Update the title, subtitle, and columns with values for our Stock Items view. Set the `formatters` to
an empty object for now.

components/StockItemList.jsx
```javascript
class StockItemList extends Component {
  title = 'Stock Items';
  subtitle = 'This is the current inventory of items';
  columns = [
    "name",
    "description",
    "stock",
    "unitPrice",
    "picture",
    "manufacturer",
  ];
  formatters = {};
 
  ...
}
```

#### Add a mock service to get the Stock Items

1. Create a directory called `services` under the client/src folder

2. Create a service called `stock-item-mock.service` initially to validate the logic. Our 
StockItem service API will have a single asynchronous function at this time called `listStockItems()`
that returns a list of StockItems. 

services/stock-item-mock.service.js
```javascript
export class StockServiceMock {
  async listStockItems() {
    await timer(1000);

    return [
      {
        "name": "Item 1",
        "description": "The first item",
        "stock": 10,
        "unitPrice": 100.0,
        "picture": "test",
        "manufacturer": "unknown",
      },
      {
        "name": "Item 2",
        "description": "The second item",
        "stock": 15,
        "unitPrice": 120.5,
        "picture": "test1",
        "manufacturer": "Apple",
      },
      {
        "name": "Item 3",
        "description": "The third item",
        "stock": 20,
        "unitPrice": 75.5,
        "picture": "test1",
        "manufacturer": "Sony",
      }
    ];
  }
}

async function timer(time) {
  return new Promise(resolve => {
    setTimeout(resolve, time)
  });
}
```

3. Update the components to pass the service in the properties

App.test.jsx
```javascript
describe('App', () => {
  test('canary verifies test infrastructure', () => {
     expect(true).toEqual(true);
  });

  test('renders without crashing', () => {
    const div = document.createElement('div');
    ReactDOM.render(<App stockService={new StockServiceMock()}/>, div);
    ReactDOM.unmountComponentAtNode(div);
  });
});
```

App.jsx
```javascript
class App extends Component {
  constructor(props) {
    super(props);

    this.stockService = props.stockService || new MockStockService();
  }

  render() {
    return (
      <div className="App">
        <UIShell stockService={this.stockService}/>
      </div>
    );
  }
}
```

components/UIShell.jsx
```javascript
class UIShell extends Component {
  ...
  
  <Content id="main-content"><UIShellBody patternName={this.state.patternName} stockService={this.props.stockService}/></Content>
 
  ...
}
```

components/UIShellBody.jsx
```javascript
class UIShellBody extends Component {
  components = {
    "Stock Items": StockItemList,
  };
  render() {
    const PatternName = this.components[
      this.props.patternName || "Stock Items"
    ];
    return (
      <div className="pattern-container">
        <PatternName showDescription={true} stockService={this.props.stockService} />
      </div>
    );
  }
}
```

4. Update `StockItemList` to use the provided service

components/StockItemList.jsx
```javascript
class StockItemList extends Component {
  ...

  constructor(props) {
    super(props);

    this.stockService = props.stockService;

    this.state = {
      data: [],
      selectedRow: 0
    };
  }

  async componentDidMount() {

    this.setState({
      data: await this.stockService.listStockItems()
    });
  }

  ...
}
```

#### Add a service that calls the BFF

1. Create a service implementation in the `services` directory called `stock-service.js`

services/stock-service.js
```javascript
export class StockService {
  async listStockItems() {
    return [];
  }
}
```

2. Add an implementation of listStockItems() that calls the BFF through the `/api` proxy

```javascript
export class StockService {
  constructor(baseUrl) {
    this.baseUrl = baseUrl || '/api';
  }

  async listStockItems() {
    return superagent
      .get(this.baseUrl + '/stock-items')
      .set('accept', 'application/json')
      .then(res => {
        console.log('Got response: ', res);
        return res.body || [];
      });
  }
}
``` 

**Note:** In dev mode the proxy is configured in `client/package.json`. When running with the express 
server the proxy is configured in `server/routers/api.js`. By default the value points to `localhost:3001`.

3. Update `App.jsx` to use the new service instead of the mock service.

App.jsx
```javascript
class App extends Component {
  constructor(props) {
    super(props);

    this.stockService = props.stockService || new StockService();
  }

  ...
}
```

4. Configure the helm chart to point to the kubernetes Service resource of the BFF.

chart/template-node-react/values.yaml
```javascript
apiHost: "inventory-management-bff:80"
``` 

### Inventory Service

### Inventory BFF

## Summary

You have now completed the Micro App Guide demonstrating the _Inventory_ solution.

## Solution Links

If you want to skip the guide and just get the components running, here are the solution Git Repositories. You can clone these and `igc pipeline` them to register them in the CI pipeline. The **README.md** may include additional setup for populating test data etc.

<AnchorLinks>
  <AnchorLink to="https://github.com/ibm-garage-cloud/inventory-ui">Inventory User Interface</AnchorLink>
  <AnchorLink to="https://github.com/ibm-garage-cloud/inventory-bff">Inventory Backend for Frontend</AnchorLink>
  <AnchorLink to="https://github.com/ibm-garage-cloud/inventory-service">Inventory Microservice</AnchorLink>
</AnchorLinks>

